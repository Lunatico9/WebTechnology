{include file="header.html" title="Header"}

<!-- Title Page -->
<section class="bg-title-page p-t-50 p-b-40 flex-col-c-m" style="background-image: url(images/cropped-fencer-2.jpg);">
	<h2 class="l-text2 t-center">
		Shop
	</h2>
</section>


<!-- Content page -->
<section class="bgwhite p-t-55 p-b-65">
	<div class="container">
		<div class="row">
			<div class="col-sm-6 col-md-4 col-lg-3 p-b-50">
				<div class="leftbar p-r-20 p-r-0-sm">
					<!-- NEED DROPDOWN ON SIDENAV -->
					<h4 class="m-text14 p-b-7">
						Categories
					</h4>

					<ul class="p-b-54">
						<li class="p-t-4">
							{if $option == ""}
								<a id="active" href="shop.php" class="s-text13 active1">
									All
								</a>
							{else}
								<a href="shop.php" class="s-text13">
									All
								</a>
							{/if}
						</li>

						<li class="p-t-4">
							{if $option == "onsale"}
								<a id="active" href="shop.php?onsale=onsale" class="s-text13 active1">
									On Sale
								</a>
							{else}
								<a href="shop.php?onsale=onsale" class="s-text13">
									On Sale
								</a>
							{/if}
						</li>

						<li class="p-t-4">
							{if $option == "swords"}
								<a id="active" href="shop.php?catalogue=swords" class="s-text13 active1">
									Swords
								</a>
							{else}
								<a href="shop.php?catalogue=swords" class="s-text13">
									Swords
								</a>
							{/if}
						</li>

						<li class="p-t-4">
							{if $option == "shields"}
								<a id="active" href="shop.php?catalogue=shields" class="s-text13 active1">
									Shields
								</a>
							{else}
								<a href="shop.php?catalogue=shields" class="s-text13">
									Shields
								</a>
							{/if}
						</li>

						<li class="p-t-4">
							{if $option == "protective gears"}
								<a id="active" href="shop.php?catalogue=protective gears" class="s-text13 active1">
									Protective gears
								</a>
							{else}
								<a href="shop.php?catalogue=protective gears" class="s-text13">
									Protective gears
								</a>
							{/if}
						</li>

						<li class="p-t-4">
							{if $option == "manuscripts"}
								<a id="active" href="shop.php?catalogue=manuscripts" class="s-text13 active1">
									Manuscripts
								</a>
							{else}
								<a href="shop.php?catalogue=manuscripts" class="s-text13">
									Manuscripts
								</a>
							{/if}
						</li>

						<li class="p-t-4">
							{if $option == "accessories"}
								<a id="active" href="shop.php?catalogue=accessories" class="s-text13 active1">
									Accesories
								</a>
							{else}
								<a href="shop.php?catalogue=accessories" class="s-text13">
									Accesories
								</a>
							{/if}
						</li>
					</ul>
					
					<div class="search-product pos-relative bo4 of-hidden">
						<form method="POST" action="shop.php">
							<input class="s-text7 size6 p-l-23 p-r-50" type="text" name="search-product" placeholder="Search Products...">
							<button class="flex-c-m size5 ab-r-m color2 color0-hov trans-0-4" type="submit">
								<i class="fs-12 fa fa-search" aria-hidden="true"></i>
							</button>
						</form>
					</div>
				</div>
			</div>
			<!-- NEED AJAX OR JS FUNCTION -->
			<div class="col-sm-6 col-md-8 col-lg-9 p-b-50">
				<div class="flex-sb-m flex-w p-b-35">
					<div class="flex-w">
						<div class="rs2-select2 bo4 of-hidden w-size12 m-t-5 m-b-5 m-r-10">
								<select class="selection-2" id="sorting" name="sorting">
									<option value="popularity">Popularity</option>
									<option value="lth">Price: low to high</option>
									<option value="htl">Price: high to low</option>
								</select>
						</div>


						<div class="rs2-select2 bo4 of-hidden w-size12 m-t-5 m-b-5 m-r-10">
								<select class="selection-2" name="price" id="price-range">
									<option value = "0,200000">Any Price</option>
									<option value = "0,50">€0 - €50</option>
									<option value = "50,100">€50 - €100</option>
									<option value = "100,200">€100 - €200</option>
									<option value = "200,200000">€200+</option>
								</select>
						</div>
                        <div class="rs2-select2 of-hidden w-size12 m-t-5 m-b-5 m-r-10">
                            <button class="flex-c-m size2 bg4 bo-rad-23 hov1 m-text3 trans-0-4" onclick="change()">Update Sorting</button>
						</div>
					</div>

					<span class="s-text8 p-t-5 p-b-5">
							Showing {$init}-{$prd} of {$total_prd} results
					</span>
				</div>

				<!-- Product -->
				<div class="row">
					{foreach item=product from=$products}
						{if $product@iteration > 12}
							<div hidden class="col-sm-12 col-md-6 col-lg-4 p-b-50">
						{else}
							<div class="col-sm-12 col-md-6 col-lg-4 p-b-50">
						{/if}
						<!-- Block2 -->
						<div class="block2">
							{if isset($product[3])}
								<div class="block2-img wrap-pic-w of-hidden pos-relative block2-labelsale">
									<img src="{$product[2]}" alt="IMG-PRODUCT">

									<div class="block2-overlay trans-0-4">
										<div class="block2-btn-addcart w-size1 trans-0-4">
											<!-- Button -->
            	                            <a href="product-detail.php?product={$product[0]}">
												<button name="{$product[0]}" class="flex-c-m size1 bg4 bo-rad-23 hov1 s-text1 trans-0-4">
													Buy Now
												</button>
                                        	</a>
										</div>
									</div>
								</div>
							{else}
								<div class="block2-img wrap-pic-w of-hidden pos-relative">
									<img src="{$product[2]}" alt="IMG-PRODUCT">

									<div class="block2-overlay trans-0-4">
										<div class="block2-btn-addcart w-size1 trans-0-4">
											<!-- Button -->
                        	                <a href="product-detail.php?product={$product[0]}">
												<button name="{$product[0]}" class="flex-c-m size1 bg4 bo-rad-23 hov1 s-text1 trans-0-4">
													Buy Now
												</button>
                                        	</a>
										</div>
									</div>
								</div>
							{/if}
							<div class="block2-txt p-t-20">
								<a href="product-detail.php?product={$product[0]}" class="block2-name dis-block s-text3 p-b-5">
									{$product[0]}
								</a>

								{if isset($product[3])}
									<span class="block2-oldprice m-text7 p-r-5">
										{$product[1]}
									</span>
									<span class="block2-newprice m-text8 p-r-5">
									    {$product[3]}
									</span>
								{else}
									<span class="block2-price m-text6 p-r-5">
										€ {$product[1]}
									</span>
								{/if}
							</div>
						</div>
							</div>
					{/foreach}
				</div>
				{if $last > 1}
					<nav aria-label="Page navigation example">
						<ul class="pagination">
							<li class="page-item"><a class="page-link" href="shop.php?page=1">First</a></li>
							{if $page > 1}
								{for $i=$page to $last max=5}
									<li class="page-item"><a class="page-link" href="shop.php?page={$i-1}">{$i-1}</a></li>
								{/for}
							{else}
								{for $i=$page to $last max=5}
									<li class="page-item"><a class="page-link" href="shop.php?page={$i}">{$i}</a></li>
								{/for}
							{/if}
							<li class="page-item"><a class="page-link" href="shop.php?page={$last}">Last</a></li>
						</ul>
					</nav>
				{/if}
			</div>
		</div>
	</div>
</section>


{include file="footer.html" title="Footer"}


<!-- Back to top -->
<div class="btn-back-to-top bg0-hov" id="myBtn">
		<span class="symbol-btn-back-to-top">
			<i class="fa fa-angle-double-up" aria-hidden="true"></i>
		</span>
</div>

<!-- Container Selection -->
<div id="dropDownSelect1"></div>
<div id="dropDownSelect2"></div>



<!--===============================================================================================-->
<script type="text/javascript" src="vendor/jquery/jquery-3.2.1.min.js"></script>
<!--===============================================================================================-->
<script type="text/javascript" src="vendor/animsition/js/animsition.min.js"></script>
<!--===============================================================================================-->
<script type="text/javascript" src="vendor/bootstrap/js/popper.js"></script>
<script type="text/javascript" src="vendor/bootstrap/js/bootstrap.min.js"></script>
<!--===============================================================================================-->
<script type="text/javascript" src="vendor/select2/select2.min.js"></script>
<script type="text/javascript">
    $(".selection-1").select2({
        minimumResultsForSearch: 20,
        dropdownParent: $('#dropDownSelect1')
    });

    $(".selection-2").select2({
        minimumResultsForSearch: 20,
        dropdownParent: $('#dropDownSelect2')
    });
</script>
<!--===============================================================================================-->
<script type="text/javascript" src="vendor/daterangepicker/moment.min.js"></script>
<script type="text/javascript" src="vendor/daterangepicker/daterangepicker.js"></script>
<!--===============================================================================================-->
<script type="text/javascript" src="vendor/slick/slick.min.js"></script>
<script type="text/javascript" src="js/slick-custom.js"></script>
<!--===============================================================================================-->
<script type="text/javascript" src="vendor/sweetalert/sweetalert.min.js"></script>
<!--
<script type="text/javascript">
    $('.block2-btn-addcart').each(function(){
        var nameProduct = $(this).parent().parent().parent().find('.block2-name').html();
        $(this).on('click', function(){
            swal(nameProduct, "is added to cart!", "success");
        });
    });
</script>
-->
<!--===============================================================================================-->
<script type="text/javascript" src="vendor/noui/nouislider.min.js"></script>
<script type="text/javascript">
    /*[ No ui ]
    ===========================================================*/
    var filterBar = document.getElementById('filter-bar');

    noUiSlider.create(filterBar, {
        start: [ 50, 200 ],
        connect: true,
        range: {
            'min': 50,
            'max': 200
        }
    });

    var skipValues = [
        document.getElementById('value-lower'),
        document.getElementById('value-upper')
    ];

    filterBar.noUiSlider.on('update', function( values, handle ) {
        skipValues[handle].innerHTML = Math.round(values[handle]) ;
    });
</script>
<!--===============================================================================================-->
<script src="js/main.js"></script>
<!-- String Sanitize Function -->
<script type="text/javascript">
    function sanitizeString(str){
        str = str.replace(/[^a-z0-9áéíóúñü \.,_-]/gim,"");
        return str.trim();
    }
</script>
<!--===============================================================================================-->
<script type="text/javascript">
    function requestOnSale(sort,min,max){
        //create and submit form with new element
        var form = $('<form></form>');
        form.attr("method", "get");
        form.attr("action", "shop.php");
        var field1 = $('<input></input>');
        field1.attr("type", "hidden");
        field1.attr("name", "price_min");
        field1.attr("value", min);
        form.append(field1);
        var field2 = $('<input></input>');
        field2.attr("type", "hidden");
        field2.attr("name", "price_max");
        field2.attr("value", max);
        form.append(field2);
        var field3 = $('<input></input>');
        field3.attr("type", "hidden");
        field3.attr("name", "sorting");
        field3.attr("value", sort);
        form.append(field3);
        var field4 = $('<input></input>');
        field4.attr("type", "hidden");
        field4.attr("name", "onsale");
        field4.attr("value", "onsale");
        form.append(field4);
        $(document.body).append(form);
        form.submit();
    };
</script>
<script type="text/javascript">
    function requestAll(sort,min,max){
        //create and submit form with new element
        var form = $('<form></form>');
        form.attr("method", "get");
        form.attr("action", "shop.php");
        var field1 = $('<input></input>');
        field1.attr("type", "hidden");
        field1.attr("name", "price_min");
        field1.attr("value", min);
        form.append(field1);
        var field2 = $('<input></input>');
        field2.attr("type", "hidden");
        field2.attr("name", "price_max");
        field2.attr("value", max);
        form.append(field2);
        var field3 = $('<input></input>');
        field3.attr("type", "hidden");
        field3.attr("name", "sorting");
        field3.attr("value", sort);
        form.append(field3);
        $(document.body).append(form);
        form.submit();
    };
</script>
<!-- sorting update request -->
<script type="text/javascript">
    function request(sort,min,max,category){
        //create and submit form with new element
        var form = $('<form></form>');
        form.attr("method", "get");
        form.attr("action", "shop.php");
        var field1 = $('<input></input>');
        field1.attr("type", "hidden");
        field1.attr("name", "price_min");
        field1.attr("value", min);
        form.append(field1);
        var field2 = $('<input></input>');
        field2.attr("type", "hidden");
        field2.attr("name", "price_max");
        field2.attr("value", max);
        form.append(field2);
        var field3 = $('<input></input>');
        field3.attr("type", "hidden");
        field3.attr("name", "sorting");
        field3.attr("value", sort);
        form.append(field3);
        var field4 = $('<input></input>');
        field4.attr("type", "hidden");
        field4.attr("name", "catalogue");
        field4.attr("value", category);
        form.append(field4);
        $(document.body).append(form);
        form.submit();
    };
</script>
<!-- Sorting update procedure -->
<script type="text/javascript">
    function change(){
        //get requested sorting and price range values
        var sorting = $("select#sorting").contents("option:selected").val();
        var pricerange = $("select#price-range").contents("option:selected").val();
        var min = pricerange.slice(0 , pricerange.indexOf(","));
        var max = pricerange.slice(pricerange.indexOf(",")+1);
        //get current product category
        var category = sanitizeString($("#active").contents().text()).toLowerCase();
        if (category == "all"){
            requestAll(sorting,min,max);
        } else {
            if (category == "on sale"){
                requestOnSale(sorting,min,max);
            } else  {
                request(sorting,min,max,category);
            }
        }   
    }
</script>


</body>
</html>
